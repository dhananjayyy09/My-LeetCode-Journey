class Solution {
public:
    // memoization
    bool solve(int i, int open, string &s, vector<vector<int>> &dp){
        int n = s.size();
        if(i == n) return open == 0;
        if(dp[i][open] != -1) return dp[i][open];
        bool ans = false;
        if(s[i] == '(') ans |= solve(i+1, open + 1, s, dp);
        else if(s[i] == '*'){
            ans |= solve(i+1, open, s, dp);
            ans |= solve(i+1, open + 1, s, dp);
            if(open > 0) ans |= solve(i+1, open - 1, s, dp);
        }
        else if(open > 0) ans |= solve(i+1, open - 1, s, dp);
        return dp[i][open] = ans;
    }

    bool checkValidStringg(string s) {
        int n = s.size();
        vector<vector<int>> dp(n, vector<int>(n, -1));
        return solve(0, 0, s, dp);
    }

    // tabulation
    bool checkValidString(string s) {
        int n = s.size();
        vector<vector<int>> dp(n+1, vector<int>(n+1, 0));
        dp[n][0] = 1;

        for(int i = n-1; i >= 0; i--){
            for(int open = n-1; open >= 0; open--){
                bool ans = false;
                if(s[i] == '(') ans |= dp[i+1][open + 1];
                else if(s[i] == '*'){
                    ans |= dp[i+1][open];
                    ans |= dp[i+1][open + 1];
                    if(open > 0) ans |= dp[i+1][open - 1];
                }
                else if(open > 0) ans |= dp[i+1][open - 1];
                dp[i][open] = ans;
            }
        }
        return dp[0][0];
    }
};
