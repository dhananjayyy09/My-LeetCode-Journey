class Solution {
public:
    static const int MOD = 1e9 + 7;
    long long totalSum = 0;
    long long maxPro = 0;
    long long solve(TreeNode *root){
        if(!root) return 0;
        long long left = solve(root->left);
        long long right = solve(root->right);
        long long sub = root->val + left + right;
        maxPro = max(maxPro, sub * (totalSum - sub));
        return sub;
    }

    int maxProduct(TreeNode *root){
        totalSum = solve(root);
        solve(root);
        return maxPro % MOD;
    }
};
